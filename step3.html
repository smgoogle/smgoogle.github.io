<!DOCTYPE HTML>
<html>
<head>
<meta charset="UTF-8">
<title>设置完成</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap-theme.min.css">
<script src="https://cdn.bootcss.com/jquery/3.4.1/jquery.js" type="text/javascript"></script>
<script src="https://cdn.bootcss.com/jquery-cookie/1.4.1/jquery.cookie.js" type="text/javascript"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/js/bootstrap.min.js" type="text/javascript"></script>
</head>
<body style="padding:10px" onload="init()">
<div style="font-size:50px;">您可以进行三天的试用，但本平台已购短信数量有限，只能为您提供100条短信进行试用。</div>
<button id="tryBtn" type="button"  class="form-control input-lg"  style="height:100px; font-size:50px; color:#FFF; background:#679deb;" onclick="beginTry()">开始试用</button>
<br><br><br><br><br><br><br><br>
<div style="font-size:50px;">可用短信条数：<label id="infoLabel">0</label> 
<button id="nextBtn" type="button" style="height:80px; font-size:50px;" onclick="refresh()">刷新</button></div>
<div style="font-size:50px;">请输入注册数量：</div>
<input id="regNum" type="text" class="form-control input-lg has-success" style="height:80px; font-size:50px;" placeholder="注册数量"><br>
<button id="beginBtn" type="button"  class="form-control input-lg"  style="height:100px; font-size:50px; color:#FFF; background:#679deb;" onclick="beginReg()">跳过试用，立刻薅羊毛</button>
<div style="font-size:50px;">如果短信余量不足，请至智码APP加购</div>
</body>
<script type="text/javascript">
function init(){
	$("#infoLabel").html($.cookie("leftSmNum"));
}
function beginTry(){
	$("#tryBtn").text('请求中...');
	$("#tryBtn").attr("disabled","disabled");
	$.ajax({
		url: "http://207.148.102.32/wm/inout/datas?method=beginTrying&pol4=" + encodeURI("1"),
		type:'GET',
		cache:false,
		xhrFields: {
			withCredentials: true
		},
		success:function(data) {
			if(data != null && data.indexOf("ERROR:")!= -1){
				alert(data);
				$("#tryBtn").text('开始试用');
				$("#tryBtn").removeAttr("disabled");
				return;
			}
			analyseData(data);
			location = "regPanel.html";
		},
		error: function(XMLHttpRequest, textStatus, errorThrown){
			alert("请求失败，请重试")
			$("#tryBtn").text('开始试用');
			$("#tryBtn").removeAttr("disabled");
		}
	});
}
function beginReg(){

	if($("#regNum").val() == null || $("#regNum").val() == '' || $("#regNum").val() == '0'){
		alert("请输入数量");
		return;
	}
	if(Number($("#regNum").val()) > Number($.cookie("leftSmNum"))){
		alert("输入注册数量不能大于可用数量");
		return;
	}
	
	if(Number($("#regNum").val()) > 50000 || Number($("#regNum").val()) < 5000){
		alert("注册数量在5千至5万之间");
		return;
	}
	$.cookie("regQuantity", $("#regNum").val())
	$.ajax({
		url: "http://207.148.102.32/wm/inout/datas?method=beginReg1&pol4=" + encodeURI($("#regNum").val()),
		type:'GET',
		cache:false,
		xhrFields: {
			withCredentials: true
		},
		success:function(data) {
			if(data != null && data.indexOf("ERROR:")!= -1){
				alert(data);
				return;
			}
			var infos = data.split("\t");
			$.cookie('beginRegTime',infos[0]);
			$.cookie('regStatus',infos[1]);
			
			refresh();
			
			location = 'regPanel.html';
		},
		error: function(XMLHttpRequest, textStatus, errorThrown){
			alert("请求错误")
		}
	});
}
function refresh(){
	$.ajax({
		url: "http://207.148.102.32/wm/inout/datas?method=baseInfo&pol4=" + encodeURI("1"),
		type:'GET',
		cache:false,
		xhrFields: {
			withCredentials: true
		},
		success:function(data) {
			if(data != null && data.indexOf("ERROR:")!= -1){
				alert(data);
				return;
			}
			analyseData(data);
			$("#infoLabel").html($.cookie("leftSmNum"));
		},
		error: function(XMLHttpRequest, textStatus, errorThrown){
			alert("请求错误");
		}
	});
}

function analyseData(data){
	var signResult = data.split("\n")
	var baseInfos = signResult[0].split(",");
	$.cookie('promRegNum', baseInfos[1].split("\t")[0]);
	$.cookie('promCkNum', baseInfos[1].split("\t")[1]);
	
	var acctSet = baseInfos[2].split("\t");
	
	$.cookie('smAccountSetted', acctSet[0]);
	$.cookie('regStatus', baseInfos[3]);
	
	$.cookie('recCode', baseInfos[5]);
	$.cookie('beginRegTime', baseInfos[6]);
	
	$.cookie('trying', baseInfos[10].split("\t")[0]);
	$.cookie('tryingRegStatus', baseInfos[10].split("\t")[1]);
	$.cookie('tryingCkInStatus', baseInfos[10].split("\t")[2]);
	
	$.cookie('cash', baseInfos[11].split("\t")[0]);
	$.cookie('withdrawed', baseInfos[11].split("\t")[1]);
	
	var regInfo = signResult[1].split(",");
	
	$.cookie('leftSmNum', regInfo[0]);
	$.cookie('expectedRegNum', regInfo[1]);
	$.cookie('currRegNum', regInfo[2]);
}
</script>
</html>