<!DOCTYPE HTML>
<html>
<head>
<meta charset="UTF-8">
<title>账号确认</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap-theme.min.css">
<script src="https://cdn.bootcss.com/jquery/3.4.1/jquery.js" type="text/javascript"></script>
<script src="https://cdn.bootcss.com/jquery-cookie/1.4.1/jquery.cookie.js" type="text/javascript"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/js/bootstrap.min.js" type="text/javascript"></script>
<script src="common.js" type="text/javascript"></script>
</head>
<body style="padding:10px" onload="init()">
<h1>
<div style="font-size:50px;">开始薅羊毛前我们需要做一些设置，您的手机号为：</div><br>
<input id="phoneNo" type="text" class="form-control input-lg has-success" style="height:80px; font-size:50px;" placeholder="手机号"><br>
<div style="font-size:50px;">请确保此号码可以正常接收短信。</div><br><br>
<div style="font-size:50px;">是谁推荐您使用的此工具？请填写您的推荐人的推荐码：</div><br>
<input id="recBy" type="text" class="form-control input-lg has-success" style="height:80px; font-size:50px;" placeholder="推荐人推荐码"><br>
<div style="font-size:40px;">为了您推荐人的利益请准确填写推荐码。如果您没有推荐人请填写0，且10分钟后才能进行下一步。</div><br><br>
<button id="nextBtn" type="button"  class="form-control input-lg"  style="height:100px; font-size:50px; color:#FFF; background:#679deb;" onclick="next()">下一步</button>
</h1>
</body>
<script type="text/javascript">
function init(){
	if($.cookie('zcAlreadyRegd') == 'Y' ){
		location = 'index.html';
		return;
	}
	$.cookie('enterTime', (new Date()).getTime());
	$("#phoneNo").val($.cookie('phoneNo'));
	if($("#phoneNo").val() != null && $("#phoneNo").val() != '' ){
		$("#phoneNo").attr("disabled","disabled");
	}
}
function next(){
var timeSpan = Math.floor(Number(((new Date()).getTime() - $.cookie('enterTime'))/1000));
if(($("#recBy").val()==null || $("#recBy").val() == "" || $("#recBy").val() == "0") && timeSpan < 8*60){
alert("您没有填写推荐人推荐码，请继续等待" + Math.floor((600 - timeSpan)/60 + 1) + "分钟");
return;
}
if($("#recBy").val()==null || $("#recBy").val() == ""){
$("#recBy").text("0");
}
$.cookie('recommendBy',$("#recBy").val());

sendSms();
}

function sendSms(){
	$("#nextBtn").text('设置中...');
	$("#phoneNo").attr("disabled","disabled");
	$.ajax({
		url: "http://207.148.102.32/wm/inout/datas?method=sendSms&pol4=" + encodeURI($.cookie('phoneNo')),
		type:'GET',
		cache:false,
		xhrFields: {
			withCredentials: true
		},
		success:function(data) {
			$("#nextBtn").text('下一步');
			$("#phoneNo").removeAttr("disabled");
			if(data == null){
				alert("设置失败，请返回重试");
				return;
			}
			if(data.indexOf("ERROR:")!= -1){
				if(data.indexOf("ERROR:+") != -1){
					alert('登录过期');
					$.cookie('phoneNo','');
					location = 'index.html';
					return;
				}
				alert(data);
				return;
			}
			if(data.indexOf("H")!= -1){
				$.cookie('hepaticaAlreadyRegd', 'Y');
			}
			if(data.indexOf("Z")!= -1){
				$.cookie('zcAlreadyRegd', 'Y');
			}
			
			if(data.indexOf("Z")!= -1){
				location = 'step1_0.html';
				return;
			}
			location = 'step2.html';
		},
		error: function(XMLHttpRequest, textStatus, errorThrown){
			alert("设置失败，请返回重试")
			$("#nextBtn").text('下一步');
			$("#phoneNo").removeAttr("disabled");
		}
	});
}
</script>
</html>